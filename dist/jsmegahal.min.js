(function(){var a,b,c,d=[].slice;a=function(){function a(a){this.tokens=a,this.canStart=!1,this.canEnd=!1}return a.prototype.hash=function(){return this.tokens.join(",")},a}(),c=function(){function b(a){this.markov=null!=a?a:4}return b.prototype.wordRegex=/[a-zA-Z0-9]/,b.prototype.words={},b.prototype.quads={},b.prototype.next={},b.prototype.prev={},b.prototype.randomInt=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},b.prototype.addQuad=function(a){return this.quads[a.hash()]=a},b.prototype.add=function(b){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(b=b.trim(),!(b.split(" ").length<this.markov)){for(i=[],f=b.split(""),c="",g=o=0,r=f.length;r>o;g=o+=1)e=f[g],this.wordRegex.test(e)?c+=e:(0!==c.length&&i.push(c),c="");for(0!==c.length&&i.push(c),j=i.length,u=[],g=p=0,s=j-this.markov-1;s>=p;g=p+=1){for(m=new a(d.call(i.slice(g,+(g+3)+1||9e9))),this.addQuad(m),m.canStart=0===g,m.canEnd=g===j-this.markov,l=q=0,t=this.markov;t>=q;l=q+=1)n=m.tokens[l],n in this.words||(this.words[n]=[]),this.words[n].push(m);0!==g&&(k=i[g-1],m.hash()in this.prev||(this.prev[m.hash()]=[]),this.prev[m.hash()].push(k)),g<j-this.markov?(h=i[g+1],m.hash()in this.next||(this.next[m.hash()]=[]),u.push(this.next[m.hash()].push(h))):u.push(void 0)}return u}},b.prototype.getReplyFromSentence=function(a){var b;return b=a.trim().split(" "),this.getReply(b[this.randomInt(0,b.length-1)])},b.prototype.getReply=function(b){var c,e,f,g,h,i,j,k,l;if(b=b.trim(),l=[],l=b&&b in this.words?this.words[b]:Object.keys(this.quads),0!==l.length){for(k=c=l[this.randomInt(0,l.length-1)],h=k.tokens;!(null!=k?k.canEnd:void 0)&&(g=this.next[k.hash()]);)f=g[this.randomInt(0,g.length-1)],e=new a(d.call(k.tokens.slice(0,+(this.markov-1)+1||9e9)).concat([f])),this.addQuad(e),k=this.quads[e.hash()],h.push(f);for(k=c;!(null!=k?k.canStart:void 0)&&(j=this.prev[k.hash()]);)i=j[this.randomInt(0,j.length-1)],e=new a(d.call(k.tokens.slice(0,+(this.markov-1)+1||9e9)).concat([i])),this.addQuad(e),k=this.quads[e.hash()],h.unshift(i);return h.join(" ")}},b}(),module.exports=b=c}).call(this);